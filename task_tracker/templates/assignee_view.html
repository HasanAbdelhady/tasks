{% extends 'base.html' %}

{% block title %}مهامي{% endblock %}

{% block content %}
<h1>مهامي</h1>

{% if not current_task %}
    <h2>اختر مهمة للعمل عليها</h2>
    <form method="POST">
        {% csrf_token %}
        {% for task in available_tasks %}
        <div class="task-option">
            <button type="submit" name="task_id" value="{{ task.id }}" class="task-select-button {% if task.deadline <= current_time %}expired{% endif %}">
                {{ task.name }}
                <small>
                    {% if task.deadline <= current_time %}
                        (منتهية)
                    {% else %}
                        (الموعد النهائي: {{ task.deadline|date:"Y-m-d H:i" }})
                    {% endif %}
                </small>
            </button>
        </div>
        {% endfor %}
    </form>
{% else %}
    <h2>المهمة الحالية: {{ current_task.name }}</h2>
    {% if current_task.deadline <= current_time %}
    <p style="text-align: center; color: #dc3545;">منتهية</p>
    {% endif %}
    <p>الموعد النهائي: {{ current_task.deadline|date:"Y-m-d H:i" }}</p>

    <form method="POST">
        {% csrf_token %}
        {% for subtask in subtasks %}
        <div class="checkbox-group">
            <label>
                {{ subtask.name }}:
                <input type="checkbox" name="{{ subtask.id }}" {% if subtask.completed %}checked{% endif %}>
            </label>
        </div>
        {% endfor %}
        <button type="submit">تحديث الحالة</button>
    </form>

    <form method="POST" style="margin-top: 20px;">
        {% csrf_token %}
        <button type="submit" name="task_id" value="" class="secondary-button">تغيير المهمة</button>
    </form>
{% endif %}

<style>
.expired {
    background-color: #ffebee !important;
    border-color: #dc3545 !important;
}

.expired small {
    color: #dc3545;
}
</style>
{% endblock %}
